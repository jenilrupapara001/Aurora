{%- liquid
  assign heading = section.settings.heading
  assign collection_list = section.blocks | where: 'type', 'collection'
-%}

<section class="featured-collections section" data-section-id="{{ section.id }}">
  <div class="container">
    {%- if heading != blank -%}
      <h2 class="section-heading">{{ heading }}</h2>
    {%- endif -%}

    <div class="featured-collections__grid">
      {%- for block in collection_list -%}
        {%- liquid
          assign collection = collections[block.settings.collection]
        -%}
        
        <div class="featured-collection-card" {{ block.shopify_attributes }}>
          <a href="{{ collection.url }}" class="featured-collection-card__link">
            <div class="featured-collection-card__media">
              {%- if collection.featured_image -%}
                <img
                  srcset="{{ collection.featured_image | image_url: width: 400 }} 400w,
                          {{ collection.featured_image | image_url: width: 600 }} 600w,
                          {{ collection.featured_image | image_url: width: 800 }} 800w"
                  src="{{ collection.featured_image | image_url: width: 600 }}"
                  alt="{{ collection.featured_image.alt | default: collection.title | escape }}"
                  loading="lazy"
                  width="{{ collection.featured_image.width }}"
                  height="{{ collection.featured_image.height }}"
                >
              {%- elsif collection.products.first and collection.products.first.featured_image -%}
                <img
                  srcset="{{ collection.products.first.featured_image | image_url: width: 400 }} 400w,
                          {{ collection.products.first.featured_image | image_url: width: 600 }} 600w,
                          {{ collection.products.first.featured_image | image_url: width: 800 }} 800w"
                  src="{{ collection.products.first.featured_image | image_url: width: 600 }}"
                  alt="{{ collection.title | escape }}"
                  loading="lazy"
                >
              {%- endif -%}
            </div>
            
            <div class="featured-collection-card__content">
              <h3 class="featured-collection-card__title">{{ collection.title }}</h3>
              <p class="featured-collection-card__count">{{ collection.products_count }} {{ 'collections.general.items_with_count.other' | t: count: collection.products_count }}</p>
            </div>
          </a>
        </div>
      {%- endfor -%}
    </div>
  </div>
</section>

<style>
  .section-heading {
    text-align: center;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 3rem;
    letter-spacing: -0.02em;
  }

  .featured-collections__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .featured-collections__grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
    }
  }

  .featured-collection-card {
    position: relative;
    overflow: hidden;
  }

  .featured-collection-card__link {
    display: block;
    text-decoration: none;
  }

  .featured-collection-card__media {
    position: relative;
    aspect-ratio: 4 / 5;
    overflow: hidden;
    background-color: var(--color-neutral-medium);
    margin-bottom: 1rem;
  }

  .featured-collection-card__media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .featured-collection-card:hover .featured-collection-card__media img {
    transform: scale(1.05);
  }

  .featured-collection-card__content {
    text-align: center;
  }

  .featured-collection-card__title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--color-neutral-dark);
  }

  .featured-collection-card__count {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
</style>

{% schema %}
{
  "name": "Featured Collections",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop by Category"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collections",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ]
    }
  ]
}
{% endschema %}
